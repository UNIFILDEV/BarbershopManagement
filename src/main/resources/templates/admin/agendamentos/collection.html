<div th:fragment="collection">
    <div th:if="${#lists.isEmpty(agendamentos)}" class="text-center py-5">
        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
        <h4 class="text-muted">Nenhum agendamento encontrado</h4>
        <p class="text-muted">Clique em "Novo Agendamento" para criar o primeiro agendamento.</p>
    </div>

    <div th:if="${!#lists.isEmpty(agendamentos)}">
        <table class="table table-bordered table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Serviço</th>
                <th>Data/Hora</th>
                <th>Status</th>
                <th>Observações</th>
                <th>Ações</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="agendamento : ${agendamentos}">
                <td th:text="${agendamento.id}"></td>
                <td th:text="${agendamento.cliente.nome}"></td>
                <td th:text="${agendamento.servico.nome}"></td>
                <td th:text="${#temporals.format(agendamento.dataHora, 'dd/MM/yyyy HH:mm')}"></td>
                <td>
                    <span th:switch="${agendamento.status}" class="badge">
                        <span th:case="'AGENDADO'" class="badge bg-warning">Agendado</span>
                        <span th:case="'CONCLUIDO'" class="badge bg-success">Concluído</span>
                        <span th:case="'CANCELADO'" class="badge bg-danger">Cancelado</span>
                        <span th:case="*" class="badge bg-secondary" th:text="${agendamento.status}"></span>
                    </span>
                </td>
                <td th:text="${agendamento.observacoes} ?: '-'"></td>
                <td class="text-center">
                    <a th:href="@{'/admin/agendamentos/' + ${agendamento.id}}" 
                       title="Ver detalhes" class="text-primary mx-1">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a th:href="@{'/admin/agendamentos/editar/' + ${agendamento.id}}" 
                       title="Editar" class="text-warning mx-1">
                        <i class="fas fa-edit"></i>
                    </a>
                    
                    <!-- Botão de status -->
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" 
                                data-bs-toggle="dropdown" title="Alterar status">
                            <i class="fas fa-cog"></i>
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <form th:action="@{'/admin/agendamentos/status/' + ${agendamento.id}}" method="post" class="d-inline">
                                    <input type="hidden" name="status" value="AGENDADO">
                                    <button type="submit" class="dropdown-item" 
                                            th:disabled="${agendamento.status == 'AGENDADO'}">
                                        <i class="fas fa-clock me-2"></i>Agendado
                                    </button>
                                </form>
                            </li>
                            <li>
                                <form th:action="@{'/admin/agendamentos/status/' + ${agendamento.id}}" method="post" class="d-inline">
                                    <input type="hidden" name="status" value="CONCLUIDO">
                                    <button type="submit" class="dropdown-item" 
                                            th:disabled="${agendamento.status == 'CONCLUIDO'}">
                                        <i class="fas fa-check me-2"></i>Concluído
                                    </button>
                                </form>
                            </li>
                            <li>
                                <form th:action="@{'/admin/agendamentos/cancelar/' + ${agendamento.id}}" method="post" class="d-inline">
                                    <button type="submit" class="dropdown-item text-danger" 
                                            th:disabled="${agendamento.status == 'CANCELADO'}"
                                            onclick="return confirm('Tem certeza que deseja cancelar este agendamento?')">
                                        <i class="fas fa-times me-2"></i>Cancelar
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                    
                    <a th:href="@{'/admin/agendamentos/deletar/' + ${agendamento.id}}"
                       onclick="return confirm('Tem certeza que deseja deletar este agendamento?')" 
                       title="Deletar" class="text-danger mx-1">
                        <i class="fas fa-trash"></i>
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
